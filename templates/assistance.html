<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New2Canada - Choose Topic</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.skypack.dev/ogl"></script>
</head>
<body class="landing-page">
    <div class="background-wrapper">
        <div id="iridescence-bg" class="background-container"
             data-effect="iridescence"
             data-color='[0.7, 0.5, 1.0]'
             data-speed="0.5"
             data-amplitude="0.15"
             data-mouse-react="true">
        </div>
    </div>
    <div class="content-wrapper">
        <div class="assistance-page-container">
            <h1 class="assistance-title">How can we help you today?</h1>
            <p class="assistance-subtitle">Choose a topic to get personalized assistance</p>
            
            <div class="assistance-container-wrapper">
                <button class="scroll-btn scroll-btn-left">‚Äπ</button>
                <div class="assistance-container">
                    <a href="/chat?category=housing" class="category-link">
                        <div class="category-icon">üè†</div>
                        <span>Housing</span>
                    </a>
                    
                    <a href="/chat?category=employment" class="category-link">
                        <div class="category-icon">üíº</div>
                        <span>Employment</span>
                    </a>
                    
                    <a href="/chat?category=education" class="category-link">
                        <div class="category-icon">üìö</div>
                        <span>Education</span>
                    </a>
                    
                    <a href="/chat?category=healthcare" class="category-link">
                        <div class="category-icon">üè•</div>
                        <span>Healthcare</span>
                    </a>
                    
                    <a href="/chat?category=immigration" class="category-link">
                        <div class="category-icon">‚úàÔ∏è</div>
                        <span>Immigration</span>
                    </a>
                    
                    <a href="/chat?category=financial" class="category-link">
                        <div class="category-icon">üí∞</div>
                        <span>Financial</span>
                    </a>

                    <a href="/chat?category=food" class="category-link">
                        <div class="category-icon">ü•´</div>
                        <span>Food</span>
                    </a>
                </div>
                <button class="scroll-btn scroll-btn-right">‚Ä∫</button>
            </div>
            
            <div class="back-link-container">
                <a href="/" class="btn btn-back">‚Üê Back to Home</a>
            </div>
        </div>
    </div>
        <script src="{{ url_for('static', filename='background-effects.js') }}"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const container = document.querySelector('.assistance-container');
                const leftBtn = document.querySelector('.scroll-btn-left');
                const rightBtn = document.querySelector('.scroll-btn-right');
                
                if (!container || !leftBtn || !rightBtn) return;

                const scrollAmount = 300;
                let isScrolling = false;

                // Clone items for seamless looping (we need enough clones to fill the viewport)
                const items = Array.from(container.children);
                const visibleItems = Math.ceil(container.clientWidth / (160 + 20)); // item width + gap
                const clonesNeeded = visibleItems + 2; // Extra buffer

                // Add clones to the end
                for (let i = 0; i < clonesNeeded; i++) {
                    items.forEach(item => {
                        const clone = item.cloneNode(true);
                        clone.setAttribute('data-clone', 'true');
                        container.appendChild(clone);
                    });
                }

                // Add clones to the beginning (for reverse scrolling)
                for (let i = 0; i < clonesNeeded; i++) {
                    items.forEach(item => {
                        const clone = item.cloneNode(true);
                        clone.setAttribute('data-clone', 'true');
                        container.insertBefore(clone, container.firstChild);
                    });
                }

                // Set initial scroll position to the first original item
                const firstOriginalItem = items[0];
                setTimeout(() => {
                    container.scrollLeft = firstOriginalItem.offsetLeft - container.offsetLeft;
                }, 100);

                function scroll(direction) {
                    if (isScrolling) return;
                    isScrolling = true;

                    const currentScroll = container.scrollLeft;
                    const newScroll = currentScroll + (scrollAmount * direction);

                    container.scrollTo({
                        left: newScroll,
                        behavior: 'smooth'
                    });

                    // Check if we need to reset position seamlessly
                    setTimeout(() => {
                        const maxScroll = container.scrollWidth - container.clientWidth;
                        const buffer = scrollAmount * 2;

                        if (direction === 1 && container.scrollLeft >= maxScroll - buffer) {
                            // We're near the end, jump to the beginning clones without animation
                            const jumpPosition = container.scrollLeft - (items.length * (160 + 20));
                            container.scrollTo({
                                left: jumpPosition,
                                behavior: 'auto'
                            });
                        } else if (direction === -1 && container.scrollLeft <= buffer) {
                            // We're near the beginning, jump to the end clones without animation
                            const jumpPosition = container.scrollLeft + (items.length * (160 + 20));
                            container.scrollTo({
                                left: jumpPosition,
                                behavior: 'auto'
                            });
                        }
                        
                        isScrolling = false;
                    }, 300);
                }

                function scrollRight() {
                    scroll(1);
                }

                function scrollLeft() {
                    scroll(-1);
                }

                // Add click event listeners
                leftBtn.addEventListener('click', scrollLeft);
                rightBtn.addEventListener('click', scrollRight);

                // Keyboard arrow support
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        scrollLeft();
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        scrollRight();
                    }
                });

                // Optional: Auto-scroll (uncomment if desired)
                /*
                let autoScroll = setInterval(scrollRight, 3000);
                
                // Pause auto-scroll on hover
                container.addEventListener('mouseenter', () => clearInterval(autoScroll));
                container.addEventListener('mouseleave', () => {
                    autoScroll = setInterval(scrollRight, 3000);
                });
                */
            });
        </script>
    </body>
    </html>